<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/papaparse.js"></script>
    <script src="/js/d3.js"></script>
    <title>oi</title>
    <style>
      body {padding: 0; margin: 0;}
      canvas {vertical-align: top;}
    </style>
  </head>
  <body>

    <script>
      var d = [];
      Papa.parse("tweets_classificados.csv", {
        download: true,
        header: true,
        complete: function(results) {
          d = results;
          monta_array();
        }
      });

      function conv_valencia(val) {
        return (val - 4)/3; // de -1 a 1
      }

      function conv_intensidade(inten) {
        return (inten - 1)/6; // de 0 a 1
      }

      var historico = [];

      function monta_array(user = null) {

        if (!user) {
          user = d.data[0].id;
        }

        var i = 0, terminou = false;
        var s_i_1 = s_i = null;
        while (!terminou) {
          if (i == d.data.length || d.data[i].id != user) {
            terminou = true;
          } else {

            historico.push({});

            if (s_i === null) { // primeiro loop 
              historico[i]["delta_t"] = 0;
              s_i = Date.parse(d.data[i].data);
            } else {

              s_i_1 = s_i;
              s_i = Date.parse(d.data[i].data);
              delta_t = s_i_1 - s_i; // qtos segundos entre eles?
              historico[i]["delta_t"] = delta_t;
            }

            historico[i]["valencia"] = conv_valencia(d.data[i].val);
            historico[i]["intensidade"] = conv_intensidade(d.data[i].int);
            
            i++;
          }
        }
  
        console.log(historico);
        console.log(historico.length);
      } 


      //https://www.youtube.com/watch?v=OZXYk_bgQGQ

      var data = [10];

      var canvas = d3.select("body")
                      .append("svg")
                      .attr("width", 500)
                      .attr("height", 500);

      var circle1 = canvas.append("circle")
                    .attr("cx", 50)
                    .attr("cy", 100)
                    .attr("r", 25);

      var circle2 = canvas.append("circle")
                    .attr("cx", 50)
                    .attr("cy", 200)
                    .attr("r", 25);

      var circles = canvas.selectAll("circle")
                  .data(data)
                  .attr("fill", "green")
                  .exit()
                    .attr("fill", "blue");



    </script>
  </body>
</html>